#define global#ifndef __MPW_VERSION__	#if defined(powerc) || defined(__powerc)		/* Pre-compiled Mac header */		#include <DGMacHeadersPPC>	#else		#include <DGMacHeaders68K>	#endif		#if __profile__		#include "profiler.h"	#endif#else	#include <AppleEvents.h>	#include <GestaltEqu.h>	#include <LowMem.h>	#include <Menus.h>	#include <Movies.h>	#include <Palettes.h>	#include <QuickDraw.h>	#include <Sound.h>	#include <StandardFile.h>	#include <Windows.h>#endif#include "LionDoom.h"#include <Lion.h>#include <ctype.h>#include "DoomResources.h"#include "doomdef.h"#include "ST_STUFF.PROTO.H"#include "HU_STUFF.H"/* * *	External Functions. * */ extern Boolean CheckForBail (void);extern void HideMenuBar (void);/* * *	External Globals. * */extern Boolean				gOneTimeFullUpdate;extern int						gLastSongStarted, 											gLastSongLooping;extern WindowPtr			gDoomWindow;extern int						quitsounds[8];extern int     				quitsounds2[8];extern int            gametic;/* * *	Prototypes. * */void AboutBox (void);int DoomStrWidth (char *str);char		*gAboutStrings[2][14] = { {		"Doom II / Hell on Earth",		   "Macintosh Version",		   		     "Conversion by",	  "Lion Entertainment, Inc.",	  		      "Programming",		    "Douglas Grounds",		      "Jason D. Mann",		    "Bob Pendleton",		      		        "Artwork",		      "Kim La Cava",		      		        "Thanks",		"Eric Klein  Eric Traut",	"Julie Allen  Kyle Humphries",	      "Rob Barris"},{		"Doom",		   "Macintosh Version",		   		     "Conversion by",	  "Lion Entertainment, Inc.",	  		      "Programming",		    "Douglas Grounds",		      "Jason D. Mann",		    "Bob Pendleton",		      		        "Artwork",		      "Kim La Cava",		      		        "Thanks",		"Eric Klein  Eric Traut",	"Julie Allen  Kyle Humphries",	      "Rob Barris"}};#define kFontLeading				10#define kMaxAboutStrings		14#define kFontWidth					 8#define kFontHeight					 7#define kMajorInset					(kFontWidth * 6)#define kTopOffset					12Point		gAboutLocs[] = {	{ 0, kTopOffset },	{ 0, kTopOffset + kFontLeading *  1 },		{ 0, kTopOffset + 10 + kFontLeading *  2 },	{ 0, kTopOffset + 10 + kFontLeading *  3 },		{ 0, kTopOffset + 18 + kFontLeading *  4 },	{ 0, kTopOffset + 18 + kFontLeading *  5 },	{ 0, kTopOffset + 18 + kFontLeading *  6 },	{ 0, kTopOffset + 18 + kFontLeading *  7 },		{ 0, kTopOffset + 26 + kFontLeading *  8 },	{ 0, kTopOffset + 26 + kFontLeading *  9 },		{ 0, kTopOffset + 34 + kFontLeading * 10 },	{ 0, kTopOffset + 34 + kFontLeading * 11 },	{ 0, kTopOffset + 34 + kFontLeading * 12 },	{ 0, kTopOffset + 34 + kFontLeading * 13 }};extern patch_t 		*hu_font[HU_FONTSIZE];/******************************************************** *	DoomStrWidth.																				* *																											* *	Get the width of the string.												* ********************************************************/int DoomStrWidth (char *str){	char			*string = str;	char			c;	int				width = 0;		while (*string != 0)	{		c = toupper(*string) - HU_FONTSTART;		string++;		if (c < 0 || c > HU_FONTSIZE)		{			width += 4;			continue;		}				width += SHORT (hu_font[c]->width);	}		return width;}/******************************************************** *	AboutBox.																						* *																											* *	Display the about box.															* ********************************************************/void AboutBox (void){  int							prevRes, prevMusic, prevLooping, x, y, j, i;  void						*bg;  char						c[2] = "x";	// dummy  Boolean					bailed;  Rect						r;  GrafPtr					oldPort;  void						*myTemp;  int							index;		HiliteMenu(0);	GetPort(&oldPort);	SetPort(gDoomWindow);	r = gDoomWindow->portRect;	r.bottom = LMGetMBarHeight();	HideMenuBar();	PaintRect(&r);		myTemp = screens[0];	screens[0] = screens[2];		// Draw everything here!		// Treat as 320x200	prevRes = gHiRes;	gHiRes = 0;					// Low Res		// Draw brown background.	if (commercial)		bg = W_CacheLumpName("INTERPIC", PU_CACHE);    // background	else	{		char		bgname[30];				if (gameepisode < 1 || gameepisode > 3)			gameepisode = 1;		sprintf(bgname, "WIMAP%d", gameepisode - 1);		bg = W_CacheLumpName(bgname, PU_CACHE);    // background	}	V_DrawPatchLRes(0, 0, 0, bg);		prevMusic = gLastSongStarted;	prevLooping = gLastSongLooping;	// "About" music	S_ChangeMusic(mus_evil, TRUE);		j = 0;	i = 0;		if (commercial)		index = 0;	else		index = 1;	x = (kScreenWidth / 2) - (DoomStrWidth(gAboutStrings[index][j]) / 2);	y = gAboutLocs[j].h;	c[1] = 0;		bailed = FALSE;		HideCursor();		while (TRUE)	{		S_ServiceMusic();		if (!bailed)		{			gOneTimeFullUpdate = 1;			I_FinishUpdate();		}				if (CheckForBail())			bailed = TRUE;				if (gAboutStrings[index][j][i] != '\0')		{			c[0] = gAboutStrings[index][j][i];			i++;			x = M_DrawText(x, y, false, c);						if (!bailed)			{				if (i == 1)					S_StartSound(0, sfx_swtchn);				else if ((i % 3) == 0)					S_StartSound(0, sfx_pistol);								Delay(2, NULL);			}		}		else		{			j++;			i = 0;						if (j >= kMaxAboutStrings)				break;						y = gAboutLocs[j].h;			x = (kScreenWidth / 2) - (DoomStrWidth(gAboutStrings[index][j]) / 2);		}	}		if (bailed)	{		gOneTimeFullUpdate = 1;		I_FinishUpdate();		bailed = FALSE;		while (CheckForBail())			;	}		while (!CheckForBail())	{		S_ServiceMusic();	}		bg = W_CacheLumpName("CREDIT", PU_CACHE);    // background	V_DrawPatchLRes(0, 0, 0, bg);	gOneTimeFullUpdate = 1;	I_FinishUpdate();	S_StartSound(0, sfx_swtchn);		while (CheckForBail())		;	ShowCursor();		while (!CheckForBail())	{		S_ServiceMusic();	}	if (commercial)		S_StartSound(NULL, quitsounds2[(gametic >> 2) & 7]);	else		S_StartSound(NULL, quitsounds[(gametic >> 2) & 7]);		// Restore music.	S_ChangeMusic(prevMusic, prevLooping);	gHiRes = prevRes;		// Restore offscreen.	screens[0] = myTemp;		gOneTimeFullUpdate = 1;	SetPort(oldPort);	FlushEvents( keyDownMask | keyUpMask | mDownMask | mUpMask | autoKeyMask, 0);}